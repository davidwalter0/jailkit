INSTALL = @INSTALL@
PACKAGE = @PACKAGE@
prefix = @prefix@

PYLIBDIR=${prefix}/share/${PACKAGE}

jk_lib.pyc:
	python -c "import py_compile;py_compile.compile('jk_lib.py')"

jk_init:
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" < jk_init.in > jk_init

jk_check:
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" < jk_check.in > jk_check

jk_cp:
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" < jk_cp.in > jk_cp

jk_addjailuser:
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" < jk_addjailuser.in > jk_addjailuser

jailkit: jk_lib.pyc jk_cp jk_init jk_check jk_addjailuser

all: jailkit

install: jailkit
	${INSTALL} -d -m 755 ${prefix}/bin
	${INSTALL} -d -m 755 ${PYLIBDIR}
	${INSTALL} -g root -o root -m 0644 jk_lib.py ${PYLIBDIR}/
	${INSTALL} -g root -o root -m 0644 jk_lib.pyc ${PYLIBDIR}/
	${INSTALL} -g root -o root -m 0755 jk_init ${prefix}/bin
	${INSTALL} -g root -o root -m 0755 jk_check ${prefix}/bin
	${INSTALL} -g root -o root -m 0755 jk_cp ${prefix}/bin
	${INSTALL} -g root -o root -m 0755 jk_addjailuser ${prefix}/bin

uninstall:
	rm -f ${prefix}/bin/jk_cp
	rm -f ${prefix}/bin/jk_init
	rm -f ${prefix}/bin/jk_check
	rm -f ${prefix}/bin/jk_addjailuser
	rm -f ${PYLIBDIR}/jk_lib.*
	rmdir ${PYLIBDIR}

clean:
	rm -f *~
	rm -f jk_lib.pyc jk_cp jk_init jk_check jk_addjailuser

distclean: clean
	rm -f Makefile
