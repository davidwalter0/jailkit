INSTALL = @INSTALL@
PACKAGE = @PACKAGE@
prefix = @prefix@
PYTHONPATH = @PYTHONPATH@

PYLIBDIR=${prefix}/share/${PACKAGE}

jk_lib.pyc: jk_lib.py
	python -c "import py_compile;py_compile.compile('jk_lib.py')"

jk_init: jk_init.in
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" -e "s:#!/usr/bin/python:#!$(PYTHONPATH):" < jk_init.in > jk_init

jk_check: jk_check.in
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" -e "s:#!/usr/bin/python:#!$(PYTHONPATH):" < jk_check.in > jk_check

jk_cp: jk_cp.in
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" -e "s:#!/usr/bin/python:#!$(PYTHONPATH):" < jk_cp.in > jk_cp

jk_addjailuser: jk_addjailuser.in
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" -e "s:#!/usr/bin/python:#!$(PYTHONPATH):" < jk_addjailuser.in > jk_addjailuser

jk_jailuser: jk_jailuser.in
	sed -e "s!LIBDIR='[a-z/]*'!LIBDIR='${PYLIBDIR}'!" -e "s:#!/usr/bin/python:#!$(PYTHONPATH):" < jk_jailuser.in > jk_jailuser

jailkit: jk_lib.pyc jk_cp jk_init jk_check jk_addjailuser jk_jailuser

all: jailkit

install: jailkit
	${INSTALL} -d -m 755 ${prefix}/sbin
	${INSTALL} -d -m 755 ${PYLIBDIR}
	${INSTALL} -g 0 -o root -m 0644 jk_lib.py ${PYLIBDIR}/
	${INSTALL} -g 0 -o root -m 0644 jk_lib.pyc ${PYLIBDIR}/
	${INSTALL} -g 0 -o root -m 0755 jk_init ${prefix}/sbin
	${INSTALL} -g 0 -o root -m 0755 jk_check ${prefix}/sbin
	${INSTALL} -g 0 -o root -m 0755 jk_cp ${prefix}/sbin
	${INSTALL} -g 0 -o root -m 0755 jk_addjailuser ${prefix}/sbin

uninstall:
	rm -f ${prefix}/sbin/jk_cp
	rm -f ${prefix}/sbin/jk_init
	rm -f ${prefix}/sbin/jk_check
	rm -f ${prefix}/sbin/jk_addjailuser
	rm -f ${PYLIBDIR}/jk_lib.*
	- rmdir --ignore-fail-on-non-empty ${PYLIBDIR}

clean:
	rm -f *~
	rm -f jk_lib.pyc jk_cp jk_init jk_check jk_addjailuser

distclean: clean
	rm -f Makefile
