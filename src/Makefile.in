INSTALL = @INSTALL@
CC = @CC@
CFLAGS = @CFLAGS@ -g -O2 -Wall -pipe
LDFLAGS = @LDFLAGS@
LIBS = @LIBS@
prefix = @prefix@

#CFLAGS = ${CFLAGS} -g -O2 -Wall -pipe

SRCS = jk_socketd.c iniparser.c jk_lsh.o jk_chrootsh.c jk_lib.c
OBJS = $(SRCS:.c=.o)

.c.o: $(SRCS)
	$(CC) $(DEFS) $(CFLAGS) -c -o $@ $<

all: jk_socketd jk_lsh jk_chrootsh

jk_socketd: $(SRCS) $(OBJS)
	$(CC) $(DEFS) -o jk_socketd jk_socketd.o iniparser.o $(LDFLAGS) $(LIBS) -lpthread

jk_lsh: $(SRCS) $(OBJS)
	$(CC) $(DEFS) -o jk_lsh jk_lsh.o iniparser.o jk_lib.o $(LDFLAGS) $(LIBS)

jk_chrootsh: $(SRCS) $(OBJS)
	$(CC) $(DEFS) -o jk_chrootsh jk_chrootsh.o $(LDFLAGS) $(LIBS)

clean:
	rm -f jk_socketd jk_lsh jk_chrootsh
	rm -f *.o
	rm -f *~

distclean: clean
	rm -f Makefile

install:
	${INSTALL} -d -m 755 ${prefix}
	${INSTALL} -d -m 755 ${prefix}/bin
	${INSTALL} -d -m 755 ${prefix}/sbin
	${INSTALL} -g root -o root -s -m 0755 jk_socketd ${prefix}/sbin/
	${INSTALL} -g root -o root -s -m 4755 jk_chrootsh  ${prefix}/bin/
	${INSTALL} -g root -o root -s -m 0755 jk_lsh  ${prefix}/bin/
	# test if the jk_chrootsh is already in /etc/shells
	if ! grep ${prefix}/bin/jk_chrootsh /etc/shells ; then \
		echo ${prefix}/bin/jk_chrootsh >> /etc/shells ;\
	fi
	
uninstall:
	rm -f  ${prefix}jk_socketd
	rm -f  ${prefix}jk_chrootsh
	rm -f  ${prefix}jk_lsh
	# remove jk_chrootsh from /etc/shells

