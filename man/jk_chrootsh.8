.TH jk_chrootsh 8 27-01-2004 JAILKIT jk_chrootsh

.SH NAME
jk_chrootsh \- a shell that will put the user inside a changed root

.SH SYNOPSIS

.B jk_chrootsh

.SH DESCRIPTION

jk_chrootsh can be used as a shell for a user. That user will be put into a changed root. The directory where to put the user in is read from the users home directory, the last occuring /./ sequence is used to mark the location of the changed root. An example line in /etc/passwd would look like

test:x:10000:10000::/home/testchroot/./home/test:/bin/jk_chrootsh

In this example the user will be chroot-ed into /home/testchroot

Inside the chroot-ed directory, it will look for /etc/passwd and it will execute the shell for the user from that file. For the above example that file should have an entry like

test:x:10000:10000::/home/test:/bin/jk_lsh

Notice that the home directory and the shell are here local inside the chroot

jk_chrootsh needs root access to make the 
.BR chroot(2)
system call. Therefore it is setuid root. It will drop its root priveleges immediately after making the chroot() system call.

By default jk_chrootsh does not copy any environment variables. For some functionality, however, environment variables need to be copied (e.g. the TERM variable for a functional terminal emulation, or the DISPLAY variable for X forwarding). In 
.I /etc/jailkit/jk_chrootsh.ini
the required environment variables can be listed. An example config file is shown below. In the example, user bill will get the DISPLAY variable, and all users in group jail will get the TERM and PATH variables. 

.nf
.sp
[bill]
env= DISPLAY

[group jail]
env = TERM, PATH
.fi

If user bill is in group jail, however, he will not get the TERM variable in the above example. First the user is checked, and only if no user section is found the group section is looked for.

.SH FILES

.I /etc/passwd
.I /etc/jailkit/jk_chrootsh.ini

.SH DIAGNOSTICS

jk_chrootsh logs everything to syslog, please check the log files

commonly made mistakes are:

forgetting to add the user to JAIL/etc/passwd or the group to JAIL/etc/group

forgetting to have the correct permissions on all files inside the jail, or forgetting files inside the jail (the shell itself, or any libraries used by the shell)

referring to a file outside the chroot

.SH AUTHOR

Jailkit is written by Olivier Sessink

.SH "SEE ALSO"

.BR jailkit(8)
.BR jk_check(8)
.BR jk_chrootlaunch(8)
.BR jk_cp(8)
.BR jk_init(8)
.BR jk_lsh(8)
.BR jk_procmailwrapper(8)
.BR jk_socketd(8)
.BR syslogd(8)

